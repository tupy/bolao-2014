{% extends "base.html" %}

{% set title = "Apostas de %s" % profile.name %}

{% block css %}
<style>
.table {
  margin: 10px 0 3px 0;
}
.table.scorer .flag {
  margin: 0 6px 0 0;
}
</style>
{% endblock %}

{% block content %}

<h1>{{profile.name}}</h1>
<h2>{{profile.score_games + (profile.bet_champions.score or 0) + (profile.bet_scorer.score or 0)}} pontos</h2>

{% if profile.games %}
  <table class="table">
  <thead>
  <tr>
    <th colspan=3>Jogos</th>
    <th width=50>pts</th>
  </tr>
  </thead>
  {% for bet in profile.games -%}
    {% set game = bet.game %}
    <tr>
      <td class="text-right"><img class="flag" src="{{url_for('static', filename='images/flags/%s.png'%game.team1.alias)}}" width="30" height="30" alt="{{game.team1}}" /></td>
      <td class="score">{{ '%d x %d' % (bet.score_team1, bet.score_team2)}}<br />
      </td>
      <td><img class="flag" src="{{url_for('static', filename='images/flags/%s.png'%game.team2.alias)}}" width="30" height="30" alt="{{game.team2}}" /></td>
      <td>{{bet.score or '0'}}</td>
    </tr>
  {% endfor %}
  </table>
  {% if profile.id == current_user.id %}
  <a href="{{url_for('.games')}}" class="btn btn-default btn-xs btn-block">Editar</a>
  {% endif %}
{% elif profile.id == current_user.id %}
<a href="{{url_for('.games')}}" class="btn btn-primary btn-block">Iniciar apostas nos jogos</a>
{% else %}
<p>Nenhuma aposta de jogo foi feita.</p>
{%endif %}

{% macro row_champion(team, position, pts=0) %}
<tr>
  <td>
  <strong>{{position}}&ordm;</strong>
{% if team %}
<img class="flag" src="{{url_for('static', filename='images/flags/%s.png'%team.alias)}}" width="30" height="30" alt="{{team.name}}" />{{team.name}}
{% else %}
&nbsp;&nbsp;<small>Não escolhido</small>
{% endif %}
  </td>
  <td>{{pts}}</td>
</tr>
{% endmacro %}

{% if profile.bet_champions %}
  {% set bet = profile.bet_champions %}
  <table class="table">
  <thead>
    <th>Seleções Campeãs</th>
    <th width=50>pts</th>
  </thead>
    {{row_champion(bet.first, 1)}}
    {{row_champion(bet.second, 2)}}
    {{row_champion(bet.third, 3)}}
    {{row_champion(bet.fourth, 4)}}
  </table>
  {% if profile.id == current_user.id %}
    <a href="{{url_for('.bet_champions', edit='edit')}}" class="btn btn-default btn-xs btn-block">Editar</a>
  {% endif %}
{% elif profile.id == current_user.id %}
<a href="{{url_for('.bet_champions')}}" class="btn btn-primary btn-block">Escolher primeiros colocados</a>
{% else %}
<p>Nenhuma seleção foi escolhida.</p>
{%endif %}

{% macro scorer_row(scorer, pts=0) %}
<tr>
  <td><img src="" /></td>
  <td>
    <strong>{{scorer.name}}</strong><br />
    <img class="flag" src="{{url_for('static', filename='images/flags/%s.png'%scorer.team.alias)}}" width="22" height="22" />
    <span class="text-muted">{{scorer.team.name}}</span>
  </td>
  <td>{{pts}}</td>
</tr>
{% endmacro %}

{% if profile.bet_scorer %}
{% set bet = profile.bet_scorer %}
  <table class="table scorer">
    <thead>
      <th colspan=2>Artilheiros</th>
      <th width=50>pts</th>
    </thead>
    {{scorer_row(bet.scorer1)}}
    {{scorer_row(bet.scorer2)}}
  </table>
  {% if profile.id == current_user.id %}
    <a href="{{url_for('.bet_scorer')}}" class="btn btn-default btn-xs btn-block">Editar</a>
  {% endif %}
{% elif profile.id == current_user.id %}
<a href="{{url_for('.bet_scorer')}}" class="btn btn-primary btn-block">Escolher meus artilheiros</a>
{% else %}
<p>Nenhum artilheiro foi escolhido.</p>
{% endif %}

{% endblock %}
